# Bug 修复说明

## 问题描述
在某些 VPS 系统上，主菜单不显示菜单项，只显示"退出"选项。

## 原因分析
1. 原有的 TOML 解析函数 `parse_toml_array()` 在某些系统的 bash/awk 版本上存在兼容性问题
2. 缺少足够的错误检查和调试信息
3. 正则表达式匹配在不同系统上可能有差异

## 修复方案

### 1. 改进的 TOML 解析函数
- 实现了双重解析策略：
  - 优先使用 awk 解析（适用于大多数系统）
  - awk 失败时自动切换到 sed+grep 组合（更高兼容性）
- 简化正则表达式，提高兼容性
- 支持单行和多行数组格式

### 2. 增强的错误处理
- 添加配置文件存在性检查
- 检查解析结果是否为空
- 检查菜单数组是否加载成功
- 提供详细的错误信息和调试提示

### 3. 代码优化
- 去除了 m.sh 中的更新检查模块
- m.sh 现在独立运行，不再依赖 menu.sh
- 统一了 m.sh 和 menu.sh 的核心功能

## 测试验证

使用 test_parse.sh 可以测试解析功能：
```bash
bash test_parse.sh
```

预期输出：
```
=== 解析 sub_menus ===
结果:
proxy
system
tools

=== 解析 titles ===
结果:
代理服务管理
系统工具
实用工具
```

## 兼容性
- 支持 bash 3.2+
- 兼容 GNU awk 和 BSD awk
- 兼容 GNU sed 和 BSD sed
- 测试通过的系统：
  - Ubuntu 20.04/22.04
  - Debian 10/11/12
  - CentOS 7/8
  - macOS

## 升级建议
如果服务器上已经安装了旧版本，建议重新运行安装脚本以更新到最新版本。
