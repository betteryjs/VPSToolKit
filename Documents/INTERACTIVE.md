# VPSToolKit 交互式菜单使用指南

## 概述

VPSToolKit 2.0 采用了类似 NodeScriptKit 的交互式菜单系统，提供更友好的用户体验。所有脚本在线执行，无需本地存储。

## 特性

### 🎯 交互式光标选择

- 使用 **↑/↓** 箭头键或 **j/k** 键移动光标
- 当前选中项会高亮显示（绿色 ▶ 标记）
- 按 **回车键** 确认选择

### 📂 面包屑导航

- 显示当前位置：`主菜单 > 代理服务管理`
- 清晰的层级结构展示
- 自动记录菜单历史，支持返回上级

### 🎨 实时预览

在二级菜单中，选中项会实时显示：
- 脚本地址（根据下载源自动切换）
- 完整的执行命令
- 方便用户确认操作

### 🌐 在线执行

- 所有脚本通过 `bash <(curl -sL URL)` 在线执行
- 始终使用最新版本
- 无需本地存储，节省空间

### 🎨 可视化界面

```
======================================
   主菜单 > 代理服务管理
======================================

 ▶ AnyTLS 管理
   Shadowsocks 管理
   Trojan-Go 管理
   Snell v4 管理
   Snell v5 管理
   返回上级菜单

======================================
使用 ↑/↓ 或 j/k 选择，Enter 确认

[执行预览]
脚本地址：https://oss.naloong.de/VPSToolKit/scripts/proxy/anytls.sh
执行命令：bash <(curl -sL "https://oss.naloong.de/VPSToolKit/scripts/proxy/anytls.sh")
```

## 操作说明

### 键盘快捷键

| 按键   | 功能                  |
| ------ | --------------------- |
| ↑ 或 k | 向上移动光标          |
| ↓ 或 j | 向下移动光标          |
| 回车   | 确认选择 / 进入子菜单 |
| q      | 退出程序              |

### 使用流程

1. **启动菜单**
   ```bash
   m
   ```

2. **浏览菜单**
   - 使用方向键或 j/k 浏览选项
   - 当前选项会高亮显示

3. **进入子菜单**
   - 移动到想要的菜单项
   - 按回车键进入

4. **执行脚本**
   - 在具体功能项上按回车
   - 脚本执行完毕后按回车返回菜单

5. **返回/退出**
   - 按 q 键返回上级菜单
   - 在主菜单选择"退出"或按 q 退出程序

## 菜单结构

```
主菜单
├── 代理服务管理
│   ├── AnyTLS 管理
│   ├── Shadowsocks 管理
│   ├── Trojan-Go 管理
│   ├── Snell v4 管理
│   └── Snell v5 管理
├── 系统工具
│   ├── BBR 加速管理
│   └── DD 重装系统
└── 实用工具
    └── Speedtest 网络测速
```

## 技术实现

### 纯 Bash 实现

VPSToolKit 的交互式菜单使用纯 Bash 脚本实现，无需额外依赖：

- 使用 `tput` 控制终端
- 使用 `read -rsn1` 读取键盘输入
- ANSI 转义序列控制颜色和光标
- 使用 `awk` 解析 TOML 配置文件

### 关键技术点

1. **光标控制**
   ```bash
   tput civis  # 隐藏光标
   tput cnorm  # 显示光标
   clear       # 清屏
   ```

2. **键盘输入**
   ```bash
   read -rsn1 key  # 读取单个字符
   case "$key" in
       A|k) # 向上
       B|j) # 向下
       "") # 回车
       q|Q) # 退出
   esac
   ```

3. **颜色显示**
   ```bash
   Green="\033[32m"   # 绿色
   Red="\033[31m"     # 红色
   Yellow="\033[0;33m" # 黄色
   Cyan="\033[0;36m"   # 青色
   Reset="\033[0m"    # 重置
   ```

4. **TOML 解析**
   ```bash
   parse_toml_array() {
       awk -v key="$key" '...' "$file"
   }
   ```

### 性能优化

1. **缓存机制**
   - 菜单加载时缓存父菜单标题
   - 避免重复解析 TOML 文件
   - 减少文件 I/O 操作

2. **渲染优化**
   - 内联 URL 生成逻辑
   - 减少函数调用开销
   - 消除闪烁问题

## 与 NodeScriptKit 的对比

| 特性     | VPSToolKit     | NodeScriptKit |
| -------- | -------------- | ------------- |
| 交互方式 | 光标选择 ✅     | 光标选择 ✅    |
| 配置系统 | TOML ✅         | TOML ✅        |
| 实现语言 | Pure Bash      | Go (nskCore)  |
| 依赖     | 无             | 需要 nskCore  |
| 性能     | 快速（已优化） | 非常快速      |
| 可移植性 | 高             | 需要编译      |
| 脚本执行 | 在线执行       | 本地存储      |
| 实时预览 | ✅              | ❌             |

## 优势

### 🚀 零依赖

- 纯 Bash 实现，无需安装额外程序
- 兼容所有支持 Bash 的 Linux 系统
- 无需编译，即装即用

### 🎨 友好界面

- 类似 Vim 的操作方式（j/k 键位）
- 直观的可视化反馈
- 清晰的面包屑导航
- 实时执行预览

### 🔧 易于扩展

- 基于 TOML 配置
- 支持自定义模块
- 模块化架构设计

### 🌐 在线执行

- 所有脚本在线下载执行
- 无需本地存储
- 始终使用最新版本
- 节省磁盘空间

## 故障排除

### 问题：光标移动不正常

**原因**：终端不支持某些控制序列

**解决**：
- 确保使用现代终端（如 xterm、gnome-terminal）
- 检查 TERM 环境变量：`echo $TERM`

### 问题：颜色显示异常

**原因**：终端颜色支持问题

**解决**：
- 确保终端支持颜色
- 使用 `export TERM=xterm-256color`

### 问题：菜单闪烁

**原因**：频繁的文件 I/O 操作

**解决**：
- 已在 v2.0.0 中通过缓存机制优化
- 更新到最新版本

### 问题：脚本执行失败

**原因**：网络连接问题或下载源不可达

**解决**：
- 检查网络连接
- 尝试切换下载源（重新运行安装脚本）
- 手动执行显示的 curl 命令

## 使用技巧

1. **快速导航**：熟悉 j/k 键位，比方向键更高效
2. **查看命令**：在二级菜单中查看执行预览，确认操作
3. **手动执行**：复制预览中的命令可以手动执行
4. **定期更新**：运行 `m` 命令时会自动检测更新

## 相关文档

- [模块配置说明](./MOUDULES.D.README.md)
- [开发指南](./DEVELOPMENT.md)
- [贡献指南](./CONTRIBUTING.md)
- [ ] 支持鼠标点击
- [ ] 主题自定义
- [ ] 开发 Go 版本 vtkCore（性能提升）
- [ ] 更多动画效果

## 反馈

如有问题或建议，请在 GitHub Issues 中反馈：
https://github.com/betteryjs/VPSToolKit/issues

---

享受新的交互式体验！ 🎉
